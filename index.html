
<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Crypto Duckies Migration" />
    <title>Crypto Duckies Migration</title>

    <link rel="stylesheet" type="text/css" href=" dist/css/main.css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L8HYPFBTLN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L8HYPFBTLN');
</script>
</head>

<body>

  <div class="page-container">

    <div class="header">

      <div class="container container--flex container--flex-ch container--large">

        <a href="https://cryptoduckies.co" class="header__logo">Crypto Duckies <span>Migration</span>

        <div class="header__socials">

          <a
            href="https://discord.gg/jn35YkYEjj"
            target="_blank"
            class="button button--round button--icon"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M6.552 6.712c-.456 0-.816.4-.816.888s.368.888.816.888c.456 0 .816-.4.816-.888.008-.488-.36-.888-.816-.888zm2.92 0c-.456 0-.816.4-.816.888s.368.888.816.888c.456 0 .816-.4.816-.888s-.36-.888-.816-.888z"
              />
              <path
                d="M13.36 0H2.64C1.736 0 1 .736 1 1.648v10.816c0 .912.736 1.648 1.64 1.648h9.072l-.424-1.48 1.024.952.968.896L15 16V1.648C15 .736 14.264 0 13.36 0zm-3.088 10.448s-.288-.344-.528-.648c1.048-.296 1.448-.952 1.448-.952-.328.216-.64.368-.92.472-.4.168-.784.28-1.16.344a5.604 5.604 0 0 1-2.072-.008 6.716 6.716 0 0 1-1.176-.344 4.688 4.688 0 0 1-.584-.272c-.024-.016-.048-.024-.072-.04-.016-.008-.024-.016-.032-.024-.144-.08-.224-.136-.224-.136s.384.64 1.4.944c-.24.304-.536.664-.536.664-1.768-.056-2.44-1.216-2.44-1.216 0-2.576 1.152-4.664 1.152-4.664 1.152-.864 2.248-.84 2.248-.84l.08.096c-1.44.416-2.104 1.048-2.104 1.048s.176-.096.472-.232c.856-.376 1.536-.48 1.816-.504.048-.008.088-.016.136-.016a6.521 6.521 0 0 1 4.024.752s-.632-.6-1.992-1.016l.112-.128s1.096-.024 2.248.84c0 0 1.152 2.088 1.152 4.664 0 0-.68 1.16-2.448 1.216z"
              />
            </svg>
          </a>
        </div>
      </div>
    </div>

    <div class="hero">

      <div class="wrap2">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAACa0lEQVR4Ae3BsY1UBwAFwLfPmxBAcl0gbQOOLnBKF0QU5GoIiGhgJVwIEjhB6wr4SKCTuX0zEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4Kedwi337RS+q4FhDQxrYFgDwxoY1sCwBoadcv9uOfD108vcsxevP+cHThnWwLAGhjUwrIFhDQxrYFgDw055/m458PXTy/B9L15/zg+ccscaGNbAsAaGNTCsgWENDGtgWAPDGhjWwLAGhjUwrIFhDQxrYFgDwxoY1sCwBoY1MKyBYQ0Ma2BYA8MaGNbAsAaGNTCsgWENDGtgWAPDGhjWwLAGhjUwrIFhDQxrYNg5HHr/8Vt+xV9//pGn9P7jt/DzGhjWwLAGhjUwrIFhDQxrYNg5HHrz9kuO3G63HPn3n1d5Sm/efsmR2+2WQ29PWdbAsAaGNTCsgWENDGtgWAPDTnn+bjnw9dPL/M5evP6cO3fKb6yBYQ0Ma2BYA8MaGNbAsAaGncP/6vZ3nrXTuzxrDQxrYFgDwxoY1sCwBoY1MOwcpp3eZVoDwxoY1sCwBoY1MKyBYQ0MO+X5u4WndModa2BYA8MaGNbAsAaGNTCsgWENDGtgWAPDGhjWwLAGhjUwrIFh59y5y+WSX3G9XsP9amBYA8MaGNbAsAaGNTCsgWHn3LmHh4f8isvlkiPX6zW/s8fHxxz58OFDljUwrIFhDQxrYFgDwxoY1sCwczj08PCQI5fLJUeu12ue0uPjY/h5DQxrYFgDwxoY1sCwBoY1MKyBYQ0Ma2BYA8MaGNbAsAaGNTCsgWENDGtgWAPDGhjWwLAGhjUw7D+NSy/gF8FrOQAAAABJRU5ErkJggg==">
      </div>
      <div class="cloud1"></div>
      <div class="cloud2"></div>
      <div class="cloud3"></div>

      <div class="debri1"></div>
      <div class="debri2"></div>
      <div class="debri3"></div>
      <div class="debri4"></div>
      <div class="debri5"></div>
      <div class="debri6"></div>


      <div class="container container--large">
        <h1 class="hero__title page-title">
          Migrate your<br />
          Duckies
        </h1>
      </div>
      <div class="container">
        <div class="hero__button-group">
          <button class="button" id="btn-connect">Connect wallet</button>
        </div>
      </div>
    </div>

    <!-- approval -->
    <section class="section section--padding section--black migration-form" id="approveBlock" style="display:none; background-color: #181818;">
      <div class="container">
        <div class="rte">
          <h2 class="title title--h2">Initiate <span>Duckie Migration</span></h2>
          <small>This will give the contract permission to interact with your Duckies. After permission is granted, you'll be brought to the migration options page. Expect a tiny, one time gas fee. </small>
        </div>
        <label>
          <button class="button button--outline-white" onclick="setApproval()">Give permission</button>
        </label>
      </div>
    </section>


    <div id="migrationBlock" style="display:none;">
      <!--- current duckies -->

      <section class="section section--padding section--black migration-form" style="background-color: #181818;">
        <div class="container">
          <h2 class="title title--h2">Your <span>unmigrated duckies</span></h2>
          <small>ⓘ Always double check.</br>ⓘ If a legacy (ERC1155) Duckie was just bought or transferred to this wallet, it could take some time before you see it listed here.</small>

          <br>
          <div id="myDuckiesImages"></div>

          <br>
          <small>Duckie ID(s) to Migrate</small>
          <div id="myDuckiesID">You have no legacy Duckies in your wallet.</div>
        
          <label>
            <button id="migrateButton" class="button button--outline-white" onclick="migrate()" disabled>Migrate Duckies</button>
          </label>
        </div>
      </section>
    </div>



    <section class="section section--padding section--yellow migration">
      <div class="container">
        <div class="grid">
          <div>
            <div class="rte">

              <h2 class="title title--h2">Benefits to Migrating</h2>
              <p>Simply put, migrating to our own ERC-721 contract expands Crypto Duckies’ utility. Here are 4 main benefits:
<br><br>1.    We are no more tied to OpenSea and can be listed on other NFT platforms like Coinbase, Rarible and Binance – we have true freedom and are completely flexible.
<br><br>2.    ERC-721 the NFT gold-standard; a nice clean contract with just Duckies. And you'll be able to pull statistics and track ownership without having to comb through the monolithic OS shared contract. It's a standard specific to the art community and blue-chip NFT projects.
<br><br>3.    Additionally, having our own ERC-721 contract allows Crypto Duckies to participate in a wider array of dApps (decentralized apps), functions (for unique utility), and systems (connect in larger ecosystems on Ethereum).
<br><br>4.    NFT picture files and the associated metadata are generally hosted on 3rd party company servers. So, if that company server goes offline (or if they choose to disconnect you), you won’t see your NFT anymore. But when you move on-chain, that means the Ethereum network hosts your image and the metadata right on the blockchain so no one can take that down. We are immutable and will live forever.</p>

              <h2 class="title title--h2">What happens with the old Duckie when I migrate?</h2>
              <p>When migrating your Duckie, the ERC1155 token will be sent to the infamous Ethereum burn address after your ERC721 equivalent has been minted for you and is safely placed on-chain and in your wallet. It all happens simultaneously.</p>

              <h2 class="title title--h2">My Wallet doesn't connect?</h2>
              <p>If you can't connect your wallet join our Discord and ping one of the online mods, we’ll be happy to help.</p>

            </div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <div class="spinner" style="display:none">
    <div class="spinner spinner--style1" title="0">
      <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="200px" height="200px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
        <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>
        <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z">
          <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="0.5s" repeatCount="indefinite"/>
        </path>
      </svg>
    </div>
  </div>

  <script type="text/javascript" src="https://unpkg.com/web3@latest/dist/web3.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript" src="https://unpkg.com/web3modal@1.9.0/dist/index.js"></script>
  <script type="text/javascript" src="https://unpkg.com/evm-chains@0.2.0/dist/umd/index.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.2.1/dist/umd/index.min.js"></script>

  <script>
  const loader = document.querySelector('.spinner');
  const approveBlock = document.querySelector('#approveBlock');
  const migrationBlock = document.querySelector('#migrationBlock');
  const connectButton = document.querySelector('.btn-connect');


  const contractLocation = {chainId: 1, address: "0x922dC160f2ab743312A6bB19DD5152C1D3Ecca33"}; // chainId 4 is Rinkeby, change to chainId 1 for Mainnet
  const contractABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"backgroundColor","outputs":[{"internalType":"bytes4","name":"","type":"bytes4"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"canMigrate","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"emergencyMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"flipMigration","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bool","name":"premultipliedAlpha","type":"bool"}],"name":"imagePixels","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"imageSVG","outputs":[{"internalType":"string","name":"svg","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isSealed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"migrate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenIds","type":"uint256[]"}],"name":"migrateFlock","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"seal","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"bytes","name":"encodedAsset","type":"bytes"}],"name":"setAsset","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"uint256[]","name":"encodedTokens","type":"uint256[]"}],"name":"setTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"toERC1155TokenId","outputs":[{"internalType":"uint256","name":"tokenIdERC1155","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"traits","outputs":[{"internalType":"string","name":"text","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]

  const contractOpenSeaLocation = {chainId: 1, address: "0x495f947276749Ce646f68AC8c248420045cb7b5e"}; // chainId 4 is Rinkeby, change to chainId 1 and change address to  0x495f947276749Ce646f68AC8c248420045cb7b5e for OpenSea on Mainnetconst
  contractOpenSeaERC1155ABI = [{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"}];


  const Web3Modal = window.Web3Modal.default;
  const WalletConnectProvider = window.WalletConnectProvider.default;
  const Fortmatic = window.Fortmatic;
  const evmChains = window.evmChains;

  let web3;
  let web3Modal
  let provider;

  let contract;
  let contractOpenSea;

  let currentAccount = null
  let approve = false;


  // --------------------------------------------------------------
  // Contract functions

  function migrate() {
    return duckieNumbers.length == 0 ? null
      : duckieNumbers.length == 1
        ? migrateOne(duckieNumbers[0])
        : migrateFlock(duckieNumbers);
  }

  function migrateOne(duckieID) {
    console.log("Migrating " + duckieID);

    const options = {
      from: currentAccount
    }

    // show loader
    loader.style.display = 'flex';

    // contract function
    contract.methods.migrate(duckieID)
    .send(options)
    .then(result => {
      console.log(result);

      Swal.fire({
        title: 'Migrated!',
        text: 'Congratulations on a successful migration!',
        icon: 'success',
        confirmButtonText: 'Ok'
      })

      // hide loader
      loader.style.display = 'none';
    }).catch(error => {
      if (error.code === 4001) {
        // User rejected transaction
        console.error("Rejected transaction");
      }
      else {
        console.error('oops', error);

        Swal.fire({
          title: 'Error!',
          text: 'Something went wrong, please try again or contact us',
          icon: 'error',
          confirmButtonText: 'Ok'
        })
      }
      // hide loader
      loader.style.display = 'none';
    });
  }

  function migrateFlock(duckieNumbers) {
    console.log("Migrating " + duckieNumbers);

    const options = {
      from: currentAccount,
    }

    // show loader
    loader.style.display = 'flex';

    // contract function
    contract.methods.migrateFlock(duckieNumbers)
    .send(options)
    .then(result => {
      console.log(result);

      Swal.fire({
        title: 'Migrated!',
        text: 'Congratulations on a successful migration!',
        icon: 'success',
        confirmButtonText: 'Ok'
      })

      // hide loader
      loader.style.display = 'none';
    }).catch(error => {
      if (error.code === 4001) {
        // User rejected transaction
        console.error("Rejected transaction");
      }
      else {
        console.error('oops', error);

        Swal.fire({
          title: 'Error!',
          text: 'Something went wrong, please try again or contact us',
          icon: 'error',
          confirmButtonText: 'Ok'
        })
      }
      // hide loader
      loader.style.display = 'none';
    });
  }

  function checkApproval() {
    // Disabled to show UI. Re-enable me!
    // contractOpenSea.methods.isApprovedForAll(currentAccount, contractLocation.address).call().then(output => {
      output = true;
      console.log('Approved:' + output);
      if (output == false) {
        approveBlock.style.display = 'block';
        migrationBlock.style.display = 'none';

      } else {
        approveBlock.style.display = 'none';
        migrationBlock.style.display = 'block';
      }

    // }).catch(error => {
    //   console.error('oops', error);
    // });
  }

  function setApproval() {
    loader.style.display = 'flex';

    contractOpenSea.methods.setApprovalForAll(contractLocation.address, true)
    .send({ from: currentAccount })
    .then(output => {
      console.log(output);
      loader.style.display = 'none';
      checkApproval();
    }).catch(error => {
      console.error('oops', error);
      loader.style.display = 'none';
    });
  }


  // --------------------------------------------------------------
  // Wallet connect functions

  function init() {
    const providerOptions = {
      walletconnect: {
        package: WalletConnectProvider,
        options: {
          infuraId: "de6285712e0749bdb5439fe5cb6da040",
        }
      }
    };

    web3Modal = new Web3Modal({
      cacheProvider: false, // optional
      providerOptions, // required
      disableInjectedProvider: false, // optional. For MetaMask / Brave / Opera.
    });

    console.log("Web3Modal instance is", web3Modal);
  }

  async function fetchAccountData() {
    web3 = new Web3(provider);
    contract = new web3.eth.Contract(contractABI, contractLocation.address);
    contractOpenSea = new web3.eth.Contract(contractOpenSeaERC1155ABI, contractOpenSeaLocation.address);

    const chainId = await web3.eth.getChainId();
    const chainData = evmChains.getChain(chainId);
    const accounts = await web3.eth.getAccounts();

    //console.log("Got accounts", accounts);
    currentAccount = accounts[0];
    console.log(currentAccount);

    document.querySelector("#btn-connect").textContent = currentAccount;

    checkApproval();
    getDuckies();
  }

  async function refreshAccountData() {
    document.querySelector("#btn-connect").setAttribute("disabled", "disabled")
    await fetchAccountData(provider);
    document.querySelector("#btn-connect").removeAttribute("disabled")
  }

  async function onConnect() {

    try {
      provider = await web3Modal.connect();
    } catch(e) {
      console.log("Could not get a wallet connection", e);
      Swal.fire({
        title: 'Error!',
        text: 'Could not get a wallet connection',
        icon: 'error',
        confirmButtonText: 'Ok'
      })
      return;
    }

    // Subscribe to accounts change
    provider.on("accountsChanged", (accounts) => {
      fetchAccountData();
      console.log(accounts);
    });

    // Subscribe to chainId change
    provider.on("chainChanged", (chainId) => {
      fetchAccountData();
    });

    // Subscribe to networkId change
    provider.on("networkChanged", (networkId) => {
      fetchAccountData();
    });

    await refreshAccountData();
  }


  // --------------------------------------------------------------
  // Get duckie number from wallet

  function getDuckies() {

    /// fix fetch multiple urls
    let url = "https://api.opensea.io/api/v1/assets?owner=" + currentAccount + "&asset_contract_address=0x495f947276749ce646f68ac8c248420045cb7b5e&collection=crypto-duckies";

    fetch(url)
      .then(response => response.json())
      .then(data => {
          var duckieData = data['assets'];
          duckieNumbers = []

          document.getElementById("myDuckiesImages").innerHTML = "";

          data.assets.forEach( function(obj) {
            var duckieId = obj.name.slice(8);
            duckieNumbers.push(duckieId);

            var imgWrapper = document.createElement("div");
            imgWrapper.className = "img-wrapper selected";

            imgWrapper.onclick = function() {
              this.classList.toggle("selected")
                ? duckieNumbers.push(duckieId)
                : duckieNumbers.splice(duckieNumbers.indexOf(duckieId), 1);

              refreshDuckieNumbers();
            }

            var img = new Image();
            img.src = obj.image_url;
            img.setAttribute("class", "image");
            img.setAttribute("alt", "effy");
            imgWrapper.appendChild(img);
            imgWrapper.innerHTML += "<br>"+duckieId;
            document.getElementById("myDuckiesImages").appendChild(imgWrapper);
          });

          refreshDuckieNumbers();
      })
  }

  function refreshDuckieNumbers() {
    document.getElementById("migrateButton").disabled = duckieNumbers.length == 0;
    document.getElementById('myDuckiesID').innerHTML =
      duckieNumbers.length == 0 ? "None" : duckieNumbers.join(", ");
  }

  window.addEventListener('load', async () => {
    init();
    document.querySelector("#btn-connect").addEventListener("click", onConnect);
  });

  // Mock account to test UI. Remove Me!
  currentAccount = "0xBFB3e090eCbb84C7436C31dfEaE08A94FDaA4D14";
  checkApproval();
  getDuckies();

  </script>

  <style>
  .spinner {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 10;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  svg path,
  svg rect{
    fill: #f7d60d;
  }
  </style>

</body>

</html>
